<!DOCTYPE html>
<html lang="pt-br">

<a href="../conexaospai.php"></a>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    <link rel="stylesheet" href="cadastro.css">
    <title>Formul√°rio</title>
</head>

<body>
    <div class="container">
        <div class="form-image">
            
        </div>
        <div class="form">
            <form autocomplete="off">
                <div class="form-header">
                    <h1>Cadastre-se</h1>

                    <a href="../../index.html"><button type="button">üè†</button></a>

                    <a href="login.html"><button type="button">Entrar</button></a>
                </div>

                <div class="input-group">
                    <div class="input-box">
                        <label for="name">Nome e Sobrenome</label>
                        <input id="name" type="text" name="name" placeholder="Digite seu nome" required>
                    </div>

                    <div class="input-box">
                        <label for="nameTrusted">Nome de Confian√ßa</label>
                        <input id="nameTrusted" type="text" name="nameTrusted" placeholder="Digite o nome de confian√ßa" required>
                    </div>

                    <div class="input-box">
                        <label for="birthdate">Data de nascimento</label>
                        <input id="birthdate" type="date" name="birthdate" required>
                    </div>

                    <div class="input-box">
                        <label for="emailTrusted">E-mail de confian√ßa</label>
                        <input id="emailTrusted" type="email" name="emailTrusted" placeholder="Digite o e-mail de confian√ßa" required>
                    </div>

                    <div class="input-box">
                        <label for="number">Celular</label>
                        <input id="number" type="tel" name="number" placeholder="xx xxxxx-xxxx" required>
                    </div>

                    <div class="input-box">
                        <label for="trustedCell">Celular de confian√ßa</label>
                        <input id="trustedCell" type="tel" name="trustedCell" placeholder="xx xxxxx-xxxx" required>
                    </div>

                    <div class="input-box">
                        <label for="cpf">CPF</label>
                        <input id="cpf" type="number" name="cpf" placeholder="Digite seu CPF" required>
                    </div>

                    <div class="input-box">
                        <label for="healthcare">Conv√™nio</label>
                        <input id="healthcare" type="text" name="healthcare" placeholder="Digite seu conv√™nio" required>
                    </div>

                    <div class="input-box">
                        <label for="zipCode">CEP</label>
                        <input id="zipCode" type="number" name="zipCode" placeholder="Digite o CEP" required>
                    </div>

                    <div class="input-box">
                        <label for="address">Endere√ßo</label>
                        <input id="address" type="text" name="address" placeholder="Digite seu endere√ßo" required>
                    </div>

                    <div class="input-box">
                        <label for="houseNumber">N√∫mero de Resid√™ncia</label>
                        <input id="houseNumber" type="text" name="houseNumber" placeholder="Digite o n√∫mero da resid√™ncia" required>
                    </div>                    

                    <div class="input-box">
                        <label for="complement">Complemento</label>
                        <input id="complement" type="text" name="complement" placeholder="Complemento (opcional)">
                    </div>

                    <div class="input-box">
                        <label for="password">Senha</label>
                        <input id="password" type="password" name="password" placeholder="Digite sua senha" required>
                    </div>

                    <div class="input-box">
                        <label for="confirmPassword">Confirme sua Senha</label>
                        <input id="confirmPassword" type="password" name="confirmPassword"
                            placeholder="Digite sua senha novamente" required>
                    </div>

                    <div class="input-box">
                        <label for="image">Foto de seu Rosto</label>
                        <input id="image" type="file" name="image" required>
                    </div>

                </div>

                <div class="gender-inputs">
                    <h6>G√™nero</h6>

                    <div class="gender-group">
                        <div class="gender-input">
                            <input id="female" type="radio" name="gender">
                            <label for="female">Feminino</label>
                        </div>

                        <div class="gender-input">
                            <input id="male" type="radio" name="gender">
                            <label for="male">Masculino</label>
                        </div>

                        <div class="gender-input">
                            <input id="others" type="radio" name="gender">
                            <label for="others">Outros</label>
                        </div>

                        <div class="gender-input">
                            <input id="none" type="radio" name="gender">
                            <label for="none">Prefiro n√£o dizer</label>
                        </div>
                    </div>
                </div>

                <button id="cadastrar"><a>cadastrar</a></button>

            </form>
        </div>
    </div>
    <script>
        const cadastrar = document.forms[0]
        const cep = document.querySelector("#zipCode")

        cep.addEventListener('input', async (e) => {
            const cepValue = e.target.value

            if (cepValue.length === 8) {
                try {
                    const request = await fetch(`https://viacep.com.br/ws/${cepValue}/json`)
                    const local = await request.json()
                    console.log(local)

                    let address = document.querySelector("#address")
                    let houseNumber = document.querySelector("#houseNumber")
                    address.value = `${local.bairro} - ${local.logradouro}` 
                    houseNumber.placeholder = local.complemento
                } catch (error) {
                    console.log(error)
                }
            } else {
                return
            }
        })

        cadastrar.addEventListener('submit', (e) => {
            console.log('clickei')
            e.preventDefault()
            
            const name = document.querySelector("#name").value
            const nameTrusted = document.querySelector("#nameTrusted").value
            const birthDate = document.querySelector("#birthdate").value
            const emailTrusted = document.querySelector("#emailTrusted").value
            const cell = document.querySelector("#number").value
            const cellTrusted = document.querySelector("#trustedCell").value
            const cpf = document.querySelector("#cpf").value
            const healthCare = document.querySelector("#healthcare").value
            const cep = document.querySelector("#zipCode").value
            const houseNumber = document.querySelector("#houseNumber").value
            const complement = document.querySelector("#complement").value
            const password = document.querySelector("#password").value
            const confirmPass = document.querySelector("#confirmPassword").value
            const image = document.querySelector("#image").files[0]

            if (password == confirmPass) {
                const reader = new FileReader()
                reader.readAsDataURL(image)
                reader.addEventListener('load', async () => {
                    const url = reader.result
                    const data = { name, nameTrusted, birthDate, emailTrusted, cell, cellTrusted, cpf, healthCare, cep, houseNumber, complement, password, url }

                    const head = {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(data)
                    }

                    try {
                        const requisition = await fetch('/register', head)
                        const result = await requisition.json()
                    } catch (err) {
                        if (err) throw err
                    }
                })

            } else {
                document.querySelector("#confirmPassword").style.backgroundColor = "#fdd3c4";
            }
        })
    </script>
</body>

</html>