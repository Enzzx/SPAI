<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chamada de üöë Ambul√¢ncia</title>
    <link rel="stylesheet" type="text/css" href="./styleEmerg.css">
</head>

<body>
    <div class="container"></div>
    <h1>Chamada de üöë Ambul√¢ncia</h1>
    <form id="ambulanceForm" method="post">
        <label for="numeroEmergencia">N√∫mero de Emerg√™ncia: 192</label>
        <br>

        <label>Motivo da Chamada:</label><br>
        <input type="radio" id="acidente" name="motivo" value="Acidente">
        <label for="acidente">Acidente</label><br>

        <input type="radio" id="doenca" name="motivo" value="Doen√ßa">
        <label for="doenca">Doen√ßa</label><br>

        <input type="radio" id="outro" name="motivo" value="Outro">
        <label for="outro">Outro</label><br>
        <br>

        <button type="submit" onclick="validateForm(event)">Confirmar Chamada</button>
    </form>

    <a href="../../index.html" id="resetForm">Voltar ao In√≠cio</a>

    <script>
        let conectado = false
        const dados = sessionStorage.getItem('dadosUser')
        if (dados !== null) {
            conectado = true
        }

        async function validateForm(event) {
            event.preventDefault();

            let motivoSelecionado = document.querySelector('input[name="motivo"]:checked');
            if (conectado) {
                if (!motivoSelecionado) {
                    alert("Selecione um motivo antes de confirmar a chamada.");
                    return false;
                }
                const id = dados.id
                const nome = dados.nome
                const localizacao = dados.cep
                const orgao = 'ambul√¢ncia'
                const motivo = motivoSelecionado.value

                const data = { id, nome, localizacao, orgao, motivo }
                const head = {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                }

                try {
                    const chamando = await fetch('/chamada', head)
                    const chamada = await chamando.json()

                    console.log('chamada armazenada')

                    window.location.assign("https://spai.onrender.com/public/emergencia/confirmacaoEmerg/confirmar-ambu.html");
                } catch (err) {
                    if (err) throw err
                    console.log('n√£o foi poss√≠vel armazenar os dados da chamada')
                }
            } else {
                console.log('voc√™ n√£o est√° conectado')
                alert("conecte-se √† uma conta")
            }
        }
    </script>
</body>

</html>